<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Policy Ballot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .instructions {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .tax-item {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fafafa;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
        }
        .tax-name {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .rating-scale {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        .rating-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            text-align: center;
        }
        .rating-input:focus {
            outline: none;
            border-color: #2196F3;
        }
        .rating-input.error {
            border-color: #f44336;
        }
        .error-message {
            color: #f44336;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        .scale-hint {
            color: #666;
            font-size: 12px;
            margin-left: 10px;
        }
        .button-container {
            text-align: center;
            margin-top: 30px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #1976D2;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #output {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
            display: none;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success-message {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
        .respondent-info {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff3e0;
            border-radius: 5px;
        }
        .respondent-info input {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            box-sizing: border-box;
        }
        .respondent-info input:required:invalid {
            border-color: #f44336;
        }
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: #2196F3;
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            margin-left: 8px;
            position: relative;
            user-select: none;
        }
        .info-icon:hover {
            background-color: #1976D2;
        }
        .tooltip {
            visibility: hidden;
            position: absolute;
            background-color: #333;
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: normal;
            line-height: 1.4;
            width: 280px;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .info-icon:hover .tooltip {
            visibility: visible;
        }
        @media (max-width: 600px) {
            .tooltip {
                width: 220px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tax Policy Ballot</h1>
        
        <div class="instructions">
            <strong>Instructions:</strong> Rate each tax type on a scale from 0-10, you may use decimals.
            <br>For scoring you should be considering administrative cost, the downstream effects, and revenue raised.
        </div>

        <div class="respondent-info">
            <label for="respondent-name"><strong>Your Name (required):</strong></label>
            <input type="text" id="respondent-name" placeholder="Enter your name" required>
        </div>

        <form id="taxBallot">
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax1"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax2"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax3"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax4"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax5"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax6"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax7"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax8"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax9"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax10"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax11"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax12"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax13"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax14"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax15"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax16"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax17"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax18"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax19"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax20"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax21"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax22"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax23"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax24"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax25"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax26"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax27"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax28"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax29"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax30"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax31"></div>
            </div>
            <div class="tax-item">
                <div class="tax-name"></div>
                <div class="rating-scale" id="tax32"></div>
            </div>
        </form>

        <div class="button-container">
            <button type="button" onclick="generateResults()">Generate Results</button>
            <button type="button" onclick="copyToClipboard()">Copy for Excel</button>
            <button type="button" onclick="downloadCSV()">Download CSV</button>
        </div>

        <div class="success-message" id="successMessage">Results copied to clipboard! Paste into Excel.</div>

        <div id="output"></div>
    </div>

    <script>
        const taxes = [
            "Trade Tariffs", "Financial Transaction Tax", "Head Tax", "Gross Receipt Tax",
            "Unrealized tax on Capital Gains", "Progressive Corporate Income Tax", 
            "Flat Corporate Income Tax", "Wealth Tax", "Retail Sales Tax", 
            "Harberger Tax on Wealth", "Realized Capital Gains Tax", "Toll Road Fees",
            "Property Tax", "Estate Tax", "Soda Tax", "Flat Income/Payroll Tax",
            "Inheritance Tax", "Progressive Income/Payroll Tax", "Vehicle Mileage Tax",
            "Value-Added Tax", "Harberger Tax on IP", "Destination-Based Cash Flow Tax",
            "Vehicle Size Tax", "Sin Tax (Broadly)", "Sugar Tax", 
            "Border Adjusted Carbon Tax", "Land Value Tax", "Externality Tax (Broadly)",
            "Resource Rent Tax", "Gift Tax", "Business License Tax/Fee", "Vacancy Tax"
        ];

        const taxDescriptions = [
            "Taxes on imported goods, used to protect domestic industries, shift production of goods important to national security away from adversaries, and raise revenue.",
            "Small tax on each financial transaction (stock trades, bond sales, etc.). Aims to reduce speculation on high-frequency trading.",
            "Fixed tax per person regardless of income or wealth.",
            "Tax on total business revenue before deducting expenses. Disadvantages low margin business relative to high margin business.",
            "Tax on increased asset value even if not sold (paper gains).",
            "Corporate tax with higher rates for higher profits. Aims to make larger/more profitable companies pay proportionally more.",
            "Corporate tax with single rate regardless of profit level.",
            "Annual tax on total net worth above a threshold.",
            "Tax on final consumer purchases.",
            "Owners self-assess asset value and pay tax on it, but must sell to anyone offering that price. Prevents undervaluation and the cost and complications of appraisal.",
            "Tax on profit from selling assets (stocks, real estate, etc.).",
            "User fees for road usage.",
            "Tax on real estate value.",
            "Tax on wealth transferred at death. Applies to the total estate before distribution to heirs.",
            "Tax on sugary soft drinks.",
            "Income/payroll tax with single rate for all income levels.",
            "Tax on wealth received by heirs. Similar to estate tax but paid by recipients rather than the estate.",
            "Income/payroll tax with higher rates at higher income levels.",
            "Tax based on miles driven rather than fuel consumed.",
            "Consumption tax collected at each production stage. Tax avoidance is more difficult, and business to business transactions are never accidentally taxed.",
            "Harberger tax applied to intellectual property. Owners self-assess IP value, pay tax, but must sell the IP to anyone paying that price.",
            "Tax on business cash flows with border adjustments. Exports untaxed, imports taxable. Subsidizes losses at the same rate as profits are taxed to be non-distortive.",
            "Tax based on vehicle weight.",
            "Category of taxes on products deemed harmful (alcohol, tobacco, gambling, etc.)",
            "Tax on products with added sugar. Similar to soda tax but broader.",
            "Tax on carbon emissions and equivalent greenhouse gases.",
            "Tax on unimproved land value only, not buildings/improvements. Encourages development and can't be avoided by reducing economic activity.",
            "Broad category taxing activities with negative spillover effects (pollution, congestion, etc.). Makes actors internalize social costs.",
            "Tax on excess profits from the non-created value of extracted resources.",
            "Tax on wealth transfers during life (vs. estate/inheritance at death). Prevents avoidance of estate/inheritance taxes.",
            "Fee/tax for operating a business in a jurisdiction. Raises local revenue and can regulate business entry.",
            "Tax on properties left vacant or underutilized."
        ];

        // Create array of indices and shuffle it
        const indices = Array.from({length: 32}, (_, i) => i);
        
        // Fisher-Yates shuffle
        function shuffle(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        const shuffledIndices = shuffle(indices);

        // Generate tax items in randomized order but store original index
        for (let displayPos = 0; displayPos < 32; displayPos++) {
            const originalIndex = shuffledIndices[displayPos];
            const containerId = `tax${displayPos + 1}`;
            const container = document.getElementById(containerId);
            
            container.innerHTML = `
                <input type="number" 
                       class="rating-input" 
                       id="${containerId}_input" 
                       name="${containerId}" 
                       data-original-index="${originalIndex}"
                       min="0" 
                       max="10" 
                       step="0.1">
                <span class="scale-hint">(0 = Strongly oppose, 10 = Strongly support)</span>
                <div class="error-message" id="${containerId}_error">Please enter a value between 0 and 10</div>
            `;
            
            // Add tax name and description with original index
            const taxItem = container.closest('.tax-item');
            const taxNameDiv = taxItem.querySelector('.tax-name');
            taxNameDiv.innerHTML = `${displayPos + 1}. ${taxes[originalIndex]}<span class="info-icon">i<span class="tooltip">${taxDescriptions[originalIndex]}</span></span>`;
            
            // Add validation on input
            const input = document.getElementById(`${containerId}_input`);
            input.addEventListener('blur', function() {
                validateInput(displayPos + 1);
            });
            input.addEventListener('input', function() {
                // Clear error styling as user types
                this.classList.remove('error');
                document.getElementById(`${containerId}_error`).style.display = 'none';
            });
        }

        function validateInput(taxNumber) {
            const input = document.getElementById(`tax${taxNumber}_input`);
            const error = document.getElementById(`tax${taxNumber}_error`);
            const value = parseFloat(input.value);
            
            if (input.value === '') {
                return false;
            }
            
            if (isNaN(value) || value < 0 || value > 10) {
                input.classList.add('error');
                error.style.display = 'block';
                return false;
            }
            
            input.classList.remove('error');
            error.style.display = 'none';
            return true;
        }

        function validateAllInputs() {
            let allValid = true;
            let allFilled = true;
            
            // Check name field
            const nameInput = document.getElementById('respondent-name');
            if (!nameInput.value.trim()) {
                alert('Please enter your name.');
                nameInput.focus();
                return false;
            }
            
            for (let i = 1; i <= 32; i++) {
                const input = document.getElementById(`tax${i}_input`);
                const value = input.value.trim();
                
                if (value === '') {
                    allFilled = false;
                    continue;
                }
                
                if (!validateInput(i)) {
                    allValid = false;
                }
            }
            
            if (!allFilled) {
                alert('Please rate all taxes before proceeding.');
                return false;
            }
            
            if (!allValid) {
                alert('Please correct all errors. All values must be between 0 and 10.');
                return false;
            }
            
            return true;
        }

        // Collect scores in original order for export
        function getScoresInOriginalOrder() {
            const scoresInOriginalOrder = new Array(32);
            
            for (let i = 1; i <= 32; i++) {
                const input = document.getElementById(`tax${i}_input`);
                const originalIndex = parseInt(input.getAttribute('data-original-index'));
                const value = parseFloat(input.value);
                scoresInOriginalOrder[originalIndex] = value;
            }
            
            return scoresInOriginalOrder;
        }

        function generateResults() {
            if (!validateAllInputs()) {
                return;
            }
            
            const name = document.getElementById('respondent-name').value;
            const scores = getScoresInOriginalOrder();
            
            let results = `Respondent: ${name}\n\n`;
            results += 'Tax Type\tScore\n';
            
            for (let i = 0; i < 32; i++) {
                results += `${taxes[i]}\t${scores[i]}\n`;
            }

            const output = document.getElementById('output');
            output.textContent = results;
            output.style.display = 'block';
        }

        function copyToClipboard() {
            if (!validateAllInputs()) {
                return;
            }
            
            const name = document.getElementById('respondent-name').value;
            const scores = getScoresInOriginalOrder();
            
            let results = `${name}\t`;
            results += scores.join('\t');

            navigator.clipboard.writeText(results).then(() => {
                const msg = document.getElementById('successMessage');
                msg.style.display = 'block';
                setTimeout(() => {
                    msg.style.display = 'none';
                }, 3000);
            });
        }

        function downloadCSV() {
            if (!validateAllInputs()) {
                return;
            }
            
            const name = document.getElementById('respondent-name').value;
            const scores = getScoresInOriginalOrder();
            
            let csv = 'Tax Type,Score,Respondent\n';
            
            for (let i = 0; i < 32; i++) {
                csv += `"${taxes[i]}",${scores[i]},"${name}"\n`;
            }

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tax_ballot_${name.replace(/\s+/g, '_')}_${Date.now()}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
